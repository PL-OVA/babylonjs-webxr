<html>
  <head>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script type="text/javascript">
      let canvas;
      let engine;
      let scene;    
      window.onload = function() {
        canvas = document.getElementById("renderCanvas");
        engine = new BABYLON.Engine(canvas, true);    
        createScene();
        addObjects();
        initializeXR();

        engine.runRenderLoop(function () {
          if (scene && scene.activeCamera) {
            scene.render();
          }
        });        
      }

      function createScene() {
        scene = new BABYLON.Scene(engine);
        scene.clearColor = new BABYLON.Color3.Blue;
        let light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(1, 1, -0.5),scene);
        let camera = new BABYLON.ArcRotateCamera("camera", -Math.PI/2,Math.PI/2, 3, new BABYLON.Vector3(0, 0, 0));
        light.castShadow = true;
        camera.attachControl(canvas, true); 
      }

      async function initializeXR(){
        let xr = await scene.createDefaultXRExperienceAsync({});  
        if (!xr.baseExperience) {}
        else {
          xr.baseExperience.featuresManager.enableFeature(BABYLON.WebXRFeatureName.HAND_TRACKING, "latest", {
            xrInput: xr.input
          });
        }        
      }

      function addObjects(){    
        let ground = BABYLON.MeshBuilder.CreateGround("ground", {width: 1000, height: 1000});

        let box = BABYLON.MeshBuilder.CreateBox("box", {width: 0.3, height: 0.3, depth: 0.3}); 
        setObjectPosition(box, 0,1,0);
        setObjectMaterial(box,new BABYLON.StandardMaterial("material"));
        setObjectMaterialColor(box,BABYLON.Color3.Random());
        addDragBehaviour(box);

        let octa = BABYLON.MeshBuilder.CreatePolyhedron("octa", {type:1,size: 0.15});
        setObjectPosition(octa,0.5,1,0);
        setGizmo(octa);
      }

      function setObjectPosition(object, xPosition,yPosition,zPosition){
        object.position.x = xPosition;
        object.position.y = yPosition;
        object.position.z = zPosition;  
      }

      function setObjectRotation(object, xRotation,yRotation,zRotation){
        object.rotation.x = xRotation;
        object.rotation.y = yRotation;
        object.rotation.z = zRotation;
      }

      function setObjectScale(object, xScale, yScale, zScale){
        object.scale.x = xScale;
        object.scale.y = yScale;
        object.scale.z = zScale;
      }

      function setObjectMaterial(object, material){
        object.material = material;
      }

      function setObjectMaterialColor(object, color){
        object.material.diffuseColor = color;
      }

      function addDragBehaviour(object){
        let sixDofDragBehavior = new BABYLON.SixDofDragBehavior();
        sixDofDragBehavior.allowMultiPointer=true;
        sixDofDragBehavior.rotateWithMotionController=false;
        object.addBehavior(sixDofDragBehavior);
      }

      function setGizmo(object){
        var gizmoManager = new BABYLON.GizmoManager(scene);
        gizmoManager.boundingBoxGizmoEnabled = true;
        gizmoManager.boundingBoxDragBehavior.allowMultiPointer=false;
        gizmoManager.gizmos.boundingBoxGizmo.setEnabledScaling(true,true);
        gizmoManager.gizmos.boundingBoxGizmo.scaleBoxSize=0.04;
        gizmoManager.gizmos.boundingBoxGizmo.rotationSphereSize=0.05; 
        gizmoManager.attachableMeshes = [object];
      }
    </script>
  </head>
  <body>
    <canvas id="renderCanvas" style="width: 100%; height: 100%;"></canvas> 
  </body>
</html>
